# pkgtorrent
pkgtorrent is a plugin for yum and solves scalability issues when a large
number of systems try to download rpm packages in bursts. This circumstance is
commonly encountered when using configuration management, e.g. Chef.

The name is pkgtorrent because the service is not specific to RPM or yum.

## Examples

* Based on usage data, approximately 40% of blocks for package downloads are
  peer-to-peer.
* Has been in continuous use at Facebook since July 2014.

## Requirements

### Client

* Linux OS (due to /proc lookups)
* CLI based bittorrent client, e.g. http://50hz.ws/hrktorrent/ with the
  following features:
 * Accepts a single positional torrent filename parameter
 * Downloads to the current working directory
 * Supports http://bittorrent.org/beps/bep_0019.htm (everything using
   libtorrent should)

### Server

* WSGI capable http server with direct file access to yum repositories "origin"
* Optional: http caching service between origin and clients
* BitTorrent Tracker, e.g. https://github.com/chihaya/chihaya

## Building pkgtorrent

Part of yum-utils

## Installing pkgtorrent

* yum install yum-plugin-pkgtorrent on clients
* yum install pkgtorrentservice on yum mirror

## How pkgtorrent works

The client calculates which packages it wishes to download, then, in a
pre-download hook, a digest of the packages is requested from the yum mirror.
If the yum mirror has seen this specific permutation before, it will
return a .torrent file and will download the files, then link them into the
local yum cache. If the permutation was not known, a POST with enough data
to build the .torrent is sent instead. In case of error, the plugin will not
download the files, so the regular download behaviour will fulfil the request.

The client will continue to seed the file for a period after the download
completes. There is no direct orchestration between clients.

If more than one file is requested, the .torrent is built with each file padded
by another "nullfile" up to the next blocksize. The nullfiles are procedurally
generated by the web server and once downloaded, are made sparse by the client.
This padding enables reuse of SHA1 block lists between different permutations
of files being downloaded. This design trades some network I/O on the part
of the client for efficiency and speed in generating the .torrent files.

## Full documentation

See the man pages:

* yum-torrent(1)
* yum-torrent.conf(5)
* pkgtorrent-service(8)
* pkgtorrent-service.conf(5)

## License
pkgtorrent is BSD-licensed. We also provide an additional patent grant.
